<!-- æ¸…æ–°ç¾ä»£åŒ–ä¸»å¸ƒå±€ -->
<div class="app-layout">
  <!-- é ‚éƒ¨å°èˆªæ¬„ -->
  <header class="app-header" *ngIf="(isAuthenticated$ | async)">
    <nav class="navbar">
      <!-- å“ç‰Œå€åŸŸ -->
      <div class="nav-brand">
        <div class="brand-logo">
          <span class="logo-icon">ğŸŒ±</span>
          <h1 class="brand-text">é ç®—åŠ©æ‰‹</h1>
        </div>
      </div>
      
      <!-- æ¡Œé¢ç‰ˆå°èˆªé¸å–® -->
      <div class="nav-links">
        <a routerLink="/dashboard" routerLinkActive="active" class="nav-link">
          <mat-icon>dashboard</mat-icon>
          <span>å„€è¡¨æ¿</span>
        </a>
        <a routerLink="/expense/add" routerLinkActive="active" class="nav-link">
          <mat-icon>add_circle_outline</mat-icon>
          <span>æ–°å¢æ”¯å‡º</span>
        </a>
        <a routerLink="/expense/history" routerLinkActive="active" class="nav-link">
          <mat-icon>timeline</mat-icon>
          <span>æ”¯å‡ºè¨˜éŒ„</span>
        </a>
        <a routerLink="/expense/budget" routerLinkActive="active" class="nav-link">
          <mat-icon>tune</mat-icon>
          <span>é ç®—è¨­å®š</span>
        </a>
      </div>

      <!-- å³å´å·¥å…·å€åŸŸ -->
      <div class="nav-tools">
        <!-- æ‰‹æ©Ÿç‰ˆèœå–®æŒ‰éˆ• -->
        <button 
          mat-icon-button 
          class="mobile-menu-button" 
          (click)="toggleMobileMenu()"
          [class.active]="showMobileMenu">
          <mat-icon>{{ showMobileMenu ? 'close' : 'menu' }}</mat-icon>
        </button>
        
        <!-- ç”¨æˆ¶é¸å–® -->
        <div class="user-menu">
          <button 
            mat-button 
            [matMenuTriggerFor]="userMenu" 
            class="user-button">
            <div class="user-avatar">
              <mat-icon>account_circle</mat-icon>
            </div>
            <div class="user-info">
              <span class="user-name">{{ (currentUser$ | async)?.displayName || 'ä½¿ç”¨è€…' }}</span>
              <span class="user-role">ç®¡ç†è€…</span>
            </div>
            <mat-icon class="dropdown-icon">keyboard_arrow_down</mat-icon>
          </button>
          
          <mat-menu #userMenu="matMenu" class="user-dropdown">
            <button mat-menu-item routerLink="/user/profile" class="menu-item">
              <mat-icon>person_outline</mat-icon>
              <span>å€‹äººè³‡æ–™</span>
            </button>
            <button mat-menu-item class="menu-item">
              <mat-icon>settings</mat-icon>
              <span>è¨­å®š</span>
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="logout()" class="menu-item logout">
              <mat-icon>logout</mat-icon>
              <span>ç™»å‡º</span>
            </button>
          </mat-menu>
        </div>
      </div>
    </nav>

    <!-- æ‰‹æ©Ÿç‰ˆå°èˆªèœå–® -->
    <div class="mobile-nav-overlay" [class.show]="showMobileMenu" (click)="closeMobileMenu()"></div>
    <div class="mobile-nav-menu" [class.show]="showMobileMenu">
      <div class="mobile-nav-header">
        <div class="mobile-user-info">
          <div class="mobile-avatar">
            <mat-icon>account_circle</mat-icon>
          </div>
          <div class="mobile-user-details">
            <span class="mobile-user-name">{{ (currentUser$ | async)?.displayName || 'ä½¿ç”¨è€…' }}</span>
            <span class="mobile-user-email">{{ (currentUser$ | async)?.username }}</span>
          </div>
        </div>
      </div>
      
      <div class="mobile-nav-content">
        <a routerLink="/dashboard" routerLinkActive="active" class="mobile-nav-item" (click)="closeMobileMenu()">
          <mat-icon>dashboard</mat-icon>
          <span>å„€è¡¨æ¿</span>
          <mat-icon class="nav-arrow">chevron_right</mat-icon>
        </a>
        <a routerLink="/expense/add" routerLinkActive="active" class="mobile-nav-item" (click)="closeMobileMenu()">
          <mat-icon>add_circle_outline</mat-icon>
          <span>æ–°å¢æ”¯å‡º</span>
          <mat-icon class="nav-arrow">chevron_right</mat-icon>
        </a>
        <a routerLink="/expense/history" routerLinkActive="active" class="mobile-nav-item" (click)="closeMobileMenu()">
          <mat-icon>timeline</mat-icon>
          <span>æ”¯å‡ºè¨˜éŒ„</span>
          <mat-icon class="nav-arrow">chevron_right</mat-icon>
        </a>
        <a routerLink="/expense/budget" routerLinkActive="active" class="mobile-nav-item" (click)="closeMobileMenu()">
          <mat-icon>tune</mat-icon>
          <span>é ç®—è¨­å®š</span>
          <mat-icon class="nav-arrow">chevron_right</mat-icon>
        </a>
        <a routerLink="/user/profile" routerLinkActive="active" class="mobile-nav-item" (click)="closeMobileMenu()">
          <mat-icon>person_outline</mat-icon>
          <span>å€‹äººè³‡æ–™</span>
          <mat-icon class="nav-arrow">chevron_right</mat-icon>
        </a>
        
        <div class="mobile-nav-divider"></div>
        
        <button class="mobile-nav-item logout-item" (click)="logout(); closeMobileMenu()">
          <mat-icon>logout</mat-icon>
          <span>ç™»å‡º</span>
          <mat-icon class="nav-arrow">chevron_right</mat-icon>
        </button>
      </div>
    </div>
  </header>

  <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
  <main class="app-main">
    <div class="content-wrapper">
      <router-outlet></router-outlet>
    </div>
  </main>
</div>