<!-- 檔案路徑: budget-assistant-web/src/app/features/dashboard/dashboard.component.html -->

<!--
  儀表板頁面模板 - 修正版本
  主要修正：
  1. 移除所有測試功能和測試用資料
  2. 增加更好的錯誤處理顯示
  3. 優化數據顯示邏輯
  4. 增加空狀態處理
-->
<div class="dashboard-container">
  
  <!-- 載入指示器 -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>載入中...</p>
  </div>

  <!-- 錯誤訊息 -->
  <div class="error-container" *ngIf="error && !isLoading">
    <mat-icon color="warn">error</mat-icon>
    <h3>載入失敗</h3>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="refreshData()">
      <mat-icon>refresh</mat-icon>
      重新載入
    </button>
  </div>

  <!-- 主要內容 -->
  <div class="dashboard-content" *ngIf="!isLoading && !error">
    
    <!-- 歡迎訊息 -->
    <div class="welcome-section">
      <h1>歡迎回來，{{ currentUser?.displayName || currentUser?.username }}！</h1>
      <p class="welcome-subtitle">這是您的{{ currentMonth }}財務概覽</p>
    </div>

    <!-- 預算狀態警示 -->
    <div class="budget-alert" *ngIf="budgetData && budgetData.totalBudget === 0">
      <mat-icon>info</mat-icon>
      <span>您尚未設定本月預算</span>
      <button mat-stroked-button color="primary" (click)="navigateToBudgetSetting()">
        立即設定
      </button>
    </div>

    <!-- 統計卡片區域 -->
    <div class="stats-grid" *ngIf="budgetData">
      
      <!-- 本月預算卡片 -->
      <mat-card class="stat-card budget-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>account_balance_wallet</mat-icon>
            本月預算
          </mat-card-title>
          <mat-card-subtitle>{{ currentMonth }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-amount">
            {{ formatCurrency(budgetData.totalBudget) }}
          </div>
          <div class="stat-description">總預算金額</div>
        </mat-card-content>
      </mat-card>

      <!-- 本月支出卡片 -->
      <mat-card class="stat-card expense-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>shopping_cart</mat-icon>
            本月支出
          </mat-card-title>
          <mat-card-subtitle>累計金額</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-amount">
            {{ formatCurrency(budgetData.totalCashExpenses) }}
          </div>
          <div class="stat-description">
            平均每日: {{ formatCurrency(dailyAverageSpent) }}
          </div>
        </mat-card-content>
      </mat-card>

      <!-- 剩餘金額卡片 -->
      <mat-card class="stat-card remaining-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>savings</mat-icon>
            剩餘金額
          </mat-card-title>
          <mat-card-subtitle>可用餘額</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-amount" [class.negative]="budgetData.remainingCash < 0">
            {{ formatCurrency(budgetData.remainingCash) }}
          </div>
          <div class="stat-description" *ngIf="remainingDays > 0">
            建議每日: {{ formatCurrency(dailyAverageRemaining) }}
          </div>
        </mat-card-content>
      </mat-card>

      <!-- 剩餘天數卡片 -->
      <mat-card class="stat-card days-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>calendar_today</mat-icon>
            剩餘天數
          </mat-card-title>
          <mat-card-subtitle>本月剩餘</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-amount">{{ remainingDays }}</div>
          <div class="stat-description">天</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- 預算使用率進度條 -->
    <mat-card class="progress-card" *ngIf="budgetData && budgetData.totalBudget > 0">
      <mat-card-header>
        <mat-card-title>預算使用率</mat-card-title>
        <mat-card-subtitle>{{ getBudgetStatusText() }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="progress-info">
          <span>已使用: {{ formatCurrency(totalSpent) }}</span>
          <span>{{ budgetUtilizationPercentage }}%</span>
        </div>
        <mat-progress-bar 
          [value]="budgetUtilizationPercentage" 
          [color]="getBudgetStatusColor()">
        </mat-progress-bar>
        <div class="progress-details">
          <small>預算總額: {{ formatCurrency(budgetData.totalBudget) }}</small>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- 快速操作區域 -->
    <div class="quick-actions">
      <h2>快速操作</h2>
      <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="navigateToAddExpense()">
          <mat-icon>add</mat-icon>
          新增支出
        </button>
        
        <button mat-raised-button color="accent" (click)="navigateToBudgetSetting()">
          <mat-icon>settings</mat-icon>
          設定預算
        </button>
        
        <button mat-stroked-button (click)="navigateToHistory()">
          <mat-icon>history</mat-icon>
          查看歷史
        </button>
      </div>
    </div>

    <!-- 空狀態提示 -->
    <div class="empty-state" *ngIf="!budgetData">
      <mat-icon>info_outline</mat-icon>
      <h3>尚無預算資料</h3>
      <p>開始設定您的第一個月預算，開啟財務管理之旅</p>
      <button mat-raised-button color="primary" (click)="navigateToBudgetSetting()">
        設定預算
      </button>
    </div>

  </div>
</div>

<!-- 注意：移除了所有測試功能相關的程式碼 -->
<!-- 如果您在其他地方看到類似的測試元件，請檢查以下檔案： -->
<!-- 1. layout.component.html 的底部 -->
<!-- 2. app.component.html 的任何測試區域 -->
<!-- 3. 任何以 test- 或 debug- 開頭的組件 -->