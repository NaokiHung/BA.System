<!-- 
æª”æ¡ˆè·¯å¾‘: budget-assistant-web/src/app/features/dashboard/dashboard.component.html
ä¿®æ­£ TypeScript éŒ¯èª¤çš„ Dashboard æ¨¡æ¿
-->

<div class="dashboard-container">
  <!-- é™¤éŒ¯è³‡è¨Šå€å¡Š -->
  <div class="debug-info" style="background: #f0f0f0; padding: 10px; margin-bottom: 20px; border-radius: 4px;">
    <h4>ğŸ”§ é™¤éŒ¯è³‡è¨Š</h4>
    <p><strong>è¼‰å…¥ç‹€æ…‹:</strong> {{ isLoading ? 'è¼‰å…¥ä¸­...' : 'è¼‰å…¥å®Œæˆ' }}</p>
    <p><strong>ä½¿ç”¨è€…:</strong> {{ currentUser?.username || 'æœªè¼‰å…¥' }}</p>
    <p><strong>éŒ¯èª¤:</strong> {{ error || 'ç„¡' }}</p>
    <p><strong>é ç®—è³‡æ–™:</strong> {{ budgetData ? 'å·²è¼‰å…¥' : 'æœªè¼‰å…¥' }}</p>
  </div>

  <!-- é é¢æ¨™é¡Œ -->
  <div class="page-header">
    <h1>å„€è¡¨æ¿</h1>
    <p *ngIf="currentUser">æ­¡è¿å›ä¾†ï¼Œ{{ currentUser.username }}ï¼</p>
  </div>

  <!-- è¼‰å…¥ä¸­ç‹€æ…‹ -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>æ­£åœ¨è¼‰å…¥å„€è¡¨æ¿è³‡æ–™...</p>
  </div>

  <!-- éŒ¯èª¤ç‹€æ…‹ -->
  <div *ngIf="error && !isLoading" class="error-container">
    <mat-card class="error-card">
      <mat-card-header>
        <mat-icon color="warn">error</mat-icon>
        <mat-card-title>è¼‰å…¥å¤±æ•—</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>{{ error }}</p>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button color="primary" (click)="refreshData()">
          <mat-icon>refresh</mat-icon>
          é‡è©¦
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- ä¸»è¦å…§å®¹ -->
  <div *ngIf="!isLoading && !error" class="dashboard-content">
    
    <!-- å¿«é€Ÿçµ±è¨ˆå¡ç‰‡ -->
    <div class="stats-grid">
      
      <!-- æœ¬æœˆé ç®—å¡ç‰‡ -->
      <mat-card class="stat-card budget-card">
        <mat-card-header>
          <mat-icon mat-card-avatar color="primary">account_balance_wallet</mat-icon>
          <mat-card-title>æœ¬æœˆé ç®—</mat-card-title>
          <mat-card-subtitle>{{ currentMonth }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="budget-info" *ngIf="budgetData; else noBudgetData">
            <div class="budget-amount">
              <span class="total">ç¸½é ç®—: ${{ budgetData.totalBudget | number }}</span>
              <span class="remaining">å‰©é¤˜: ${{ budgetData.remainingCash | number }}</span>
            </div>
            <div class="budget-progress">
              <mat-progress-bar 
                mode="determinate" 
                [value]="budgetUtilizationPercentage"
                [color]="budgetUtilizationPercentage > 80 ? 'warn' : 'primary'">
              </mat-progress-bar>
              <span class="percentage">å·²ä½¿ç”¨ {{ budgetUtilizationPercentage }}%</span>
            </div>
          </div>
          <ng-template #noBudgetData>
            <p>å°šæœªè¨­å®šæœ¬æœˆé ç®—</p>
          </ng-template>
        </mat-card-content>
      </mat-card>

      <!-- æœ¬æœˆæ”¯å‡ºå¡ç‰‡ -->
      <mat-card class="stat-card expense-card">
        <mat-card-header>
          <mat-icon mat-card-avatar color="accent">shopping_cart</mat-icon>
          <mat-card-title>æœ¬æœˆæ”¯å‡º</mat-card-title>
          <mat-card-subtitle>ç´¯è¨ˆé‡‘é¡</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="expense-amount">
            <!-- ä¿®æ­£ï¼šä½¿ç”¨ totalCashExpenses è€Œä¸æ˜¯ totalExpenses -->
            ${{ budgetData?.totalCashExpenses | number }}
          </div>
        </mat-card-content>
      </mat-card>

      <!-- å‰©é¤˜å¤©æ•¸å¡ç‰‡ -->
      <mat-card class="stat-card days-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>calendar_today</mat-icon>
          <mat-card-title>æœ¬æœˆå‰©é¤˜</mat-card-title>
          <mat-card-subtitle>å¤©æ•¸</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="days-count">
            {{ remainingDays }} å¤©
          </div>
        </mat-card-content>
      </mat-card>

      <!-- è¨‚é–±æœå‹™å¡ç‰‡ -->
      <mat-card class="stat-card subscription-card">
        <mat-card-header>
          <mat-icon mat-card-avatar color="accent">subscriptions</mat-icon>
          <mat-card-title>è¨‚é–±æœå‹™</mat-card-title>
          <mat-card-subtitle>æœ¬æœˆè²»ç”¨</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="subscription-amount">
            ${{ budgetData?.totalSubscriptions | number }}
          </div>
        </mat-card-content>
      </mat-card>

      <!-- ä¿¡ç”¨å¡å¡ç‰‡ -->
      <mat-card class="stat-card credit-card">
        <mat-card-header>
          <mat-icon mat-card-avatar color="warn">credit_card</mat-icon>
          <mat-card-title>ä¿¡ç”¨å¡æ¶ˆè²»</mat-card-title>
          <mat-card-subtitle>æœ¬æœˆç´¯è¨ˆ</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="credit-amount">
            ${{ budgetData?.totalCreditCard | number }}
          </div>
        </mat-card-content>
      </mat-card>

      <!-- ç¸½è¨ˆæ¶ˆè²»å¡ç‰‡ -->
      <mat-card class="stat-card total-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>monetization_on</mat-icon>
          <mat-card-title>ç¸½è¨ˆæ¶ˆè²»</mat-card-title>
          <mat-card-subtitle>ä¿¡ç”¨å¡+è¨‚é–±</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="total-amount">
            ${{ budgetData?.combinedCreditTotal | number }}
          </div>
        </mat-card-content>
      </mat-card>

    </div>

    <!-- å¿«é€Ÿæ“ä½œå€åŸŸ -->
    <div class="quick-actions">
      <h2>å¿«é€Ÿæ“ä½œ</h2>
      <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="navigateToExpenses()">
          <mat-icon>add</mat-icon>
          æ–°å¢æ”¯å‡º
        </button>
        <button mat-raised-button color="accent" (click)="navigateToBudget()">
          <mat-icon>account_balance</mat-icon>
          è¨­å®šé ç®—
        </button>
        <button mat-raised-button (click)="navigateToHistory()">
          <mat-icon>history</mat-icon>
          æŸ¥çœ‹æ­·å²
        </button>
      </div>
    </div>

    <!-- æ¸¬è©¦æŒ‰éˆ• -->
    <div class="test-buttons" style="margin-top: 20px;">
      <h3>ğŸ§ª æ¸¬è©¦åŠŸèƒ½</h3>
      <button mat-button color="primary" (click)="refreshData()">é‡æ–°è¼‰å…¥è³‡æ–™</button>
      <button mat-button color="warn" (click)="authService.logout()">ç™»å‡ºæ¸¬è©¦</button>
    </div>
    
  </div>
</div>