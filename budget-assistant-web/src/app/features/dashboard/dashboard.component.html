<!--
  儀表板頁面模板
  為什麼使用卡片式布局？
  1. 視覺層次清楚，資訊分類明確
  2. 響應式設計友善
  3. 符合 Material Design 規範
-->
<div class="dashboard-container">
  <!-- 載入指示器 -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>載入中...</p>
  </div>

  <!-- 錯誤訊息 -->
  <div class="error-container" *ngIf="error && !isLoading">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="refreshData()">
      重新載入
    </button>
  </div>

  <!-- 主要內容 -->
  <div class="dashboard-content" *ngIf="!isLoading && !error">
    <!-- 歡迎訊息 -->
    <div class="welcome-section">
      <h1>歡迎回來，{{ currentUser?.displayName || currentUser?.username }}！</h1>
      <p class="welcome-subtitle">這是您的{{ currentMonth }}財務概覽</p>
    </div>

    <!-- 統計卡片區域 -->
    <div class="stats-grid">
      <!-- 本月預算卡片 -->
      <mat-card class="stat-card budget-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>account_balance_wallet</mat-icon>
            本月預算
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-amount" *ngIf="budgetData">
            {{ formatCurrency(budgetData.totalBudget) }}
          </div>
          <div class="stat-description">總預算金額</div>
        </mat-card-content>
      </mat-card>

      <!-- 剩餘金額卡片 -->
      <mat-card class="stat-card remaining-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>savings</mat-icon>
            剩餘金額
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-amount" *ngIf="budgetData">
            {{ formatCurrency(budgetData.remainingCash) }}
          </div>
          <div class="stat-description">可用餘額</div>
        </mat-card-content>
      </mat-card>

      <!-- 已支出金額卡片 -->
      <mat-card class="stat-card expense-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>shopping_cart</mat-icon>
            已支出
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-amount" *ngIf="budgetData">
            {{ formatCurrency(budgetData.totalCashExpenses) }}
          </div>
          <div class="stat-description">本月支出</div>
        </mat-card-content>
      </mat-card>

      <!-- 剩餘天數卡片 -->
      <mat-card class="stat-card days-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>calendar_today</mat-icon>
            剩餘天數
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-amount">{{ remainingDays }}</div>
          <div class="stat-description">本月剩餘</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- 預算使用率進度條 -->
    <mat-card class="progress-card" *ngIf="budgetData && budgetData.totalBudget > 0">
      <mat-card-header>
        <mat-card-title>預算使用率</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="progress-info">
          <span>{{ budgetUtilizationPercentage }}% 已使用</span>
          <span>{{ formatCurrency(budgetData.remainingCash) }} 剩餘</span>
        </div>
        <mat-progress-bar 
          [value]="budgetUtilizationPercentage" 
          [color]="getBudgetStatusColor()"
          mode="determinate">
        </mat-progress-bar>
      </mat-card-content>
    </mat-card>

    <!-- 快速操作區域 -->
    <div class="quick-actions">
      <h2>快速操作</h2>
      <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="navigateToExpense()">
          <mat-icon>add</mat-icon>
          新增支出
        </button>
        
        <button mat-raised-button color="accent" (click)="navigateToBudget()">
          <mat-icon>settings</mat-icon>
          設定預算
        </button>
        
        <button mat-stroked-button (click)="navigateToHistory()">
          <mat-icon>history</mat-icon>
          查看記錄
        </button>
      </div>
    </div>

    <!-- 空狀態提示 -->
    <mat-card class="empty-state" *ngIf="budgetData && budgetData.totalBudget === 0">
      <mat-card-content>
        <mat-icon>info</mat-icon>
        <h3>開始使用理財管理系統</h3>
        <p>您還沒有設定本月預算，請先設定預算來開始管理您的財務。</p>
        <button mat-raised-button color="primary" (click)="navigateToBudget()">
          立即設定預算
        </button>
      </mat-card-content>
    </mat-card>
  </div>
</div>